<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HK AI - CORE</title>
    <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: #000; color: #fff; font-family: 'Unbounded', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        #bg-glass { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; opacity: 0.1; pointer-events: none; }
        header { padding: 20px; text-align: center; z-index: 10; border-bottom: 1px solid #111; }
        .logo { background: #fff; color: #000; display: inline-block; padding: 10px 25px; border-radius: 8px; font-weight: 900; font-size: 16px; text-transform: uppercase; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; z-index: 1; }
        .m { max-width: 85%; padding: 14px; border-radius: 15px; font-size: 14px; font-weight: 700; line-height: 1.3; }
        .ai { align-self: flex-start; background: #fff; color: #000; border-bottom-left-radius: 2px; }
        .user { align-self: flex-end; background: #222; color: #fff; border-bottom-right-radius: 2px; }
        .f { padding: 20px; background: #000; display: flex; gap: 10px; border-top: 1px solid #111; z-index: 10; }
        input { flex: 1; background: #111; border: 1px solid #333; padding: 15px; border-radius: 12px; font-family: 'Unbounded'; color: #fff; font-weight: 700; }
        button { background: #fff; border: none; border-radius: 12px; padding: 0 20px; font-weight: 900; cursor: pointer; }
        #status { font-size: 10px; color: #444; text-align: center; padding-bottom: 10px; font-weight: 700; }
    </style>
</head>
<body>
    <div id="bg-glass"></div>
    <header><div class="logo">HK AI System</div></header>
    <div id="chat"></div>
    <div id="status">СИСТЕМА: ГОТОВА</div>
    <div class="f">
        <input type="text" id="msg-input" placeholder="ВВОД..." autocomplete="off">
        <button onclick="sendMsg()">OK</button>
    </div>

    <script>
        const API_KEY = "AIzaSyDtzX7qbF0C1KjhfShopGLctIbGLiO_Z6w";

        async function sendMsg() {
            const input = document.getElementById('msg-input');
            const val = input.value.trim();
            if (!val) return;

            addMsg(val, 'user');
            input.value = '';
            document.getElementById('status').innerText = "ГЕНЕРАЦИЯ ОТВЕТА...";

            try {
                // ИСПОЛЬЗУЕМ КРОСС-ДОМЕННЫЙ ПРОКСИ ДЛЯ ОБХОДА БЛОКИРОВОК TELEGRAM
                const targetUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
                
                // Это заставит запрос выглядеть как обычный переход по ссылке
                const proxyUrl = "https://api.allorigins.win/get?url=" + encodeURIComponent(targetUrl);

                const response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: "ОТВЕТЬ КОРОТКО И КАПСОМ: " + val }] }]
                    })
                });

                // Если AllOrigins не пропустил POST, пробуем ПРЯМОЙ запрос с заголовками "невидимками"
                if (!response.ok) {
                    throw new Error("PROXY ERROR");
                }

                const data = await response.json();
                // Распаковываем данные из прокси
                const geminiData = JSON.parse(data.contents);
                
                if (geminiData.candidates && geminiData.candidates[0].content) {
                    const aiText = geminiData.candidates[0].content.parts[0].text.toUpperCase();
                    addMsg(aiText, 'ai');
                } else {
                    throw new Error("EMPTY DATA");
                }

            } catch (e) {
                // Если прокси не сработал, пробуем прямой запрос (последний шанс)
                try {
                    const directRes = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ contents: [{ parts: [{ text: val }] }] })
                    });
                    const dData = await directRes.json();
                    addMsg(dData.candidates[0].content.parts[0].text.toUpperCase(), 'ai');
                } catch (err) {
                    addMsg("ОШИБКА ДОСТУПА. ПРОВЕРЬ VPN ЕЩЕ РАЗ!", "ai");
                }
            } finally {
                document.getElementById('status').innerText = "СИСТЕМА: ОЖИДАНИЕ";
            }
        }

        function addMsg(text, type) {
            const div = document.createElement('div');
            div.className = `m ${type}`;
            div.innerText = text;
            const chat = document.getElementById('chat');
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        document.getElementById('msg-input').onkeydown = (e) => { if(e.key === 'Enter') sendMsg(); };

        // Символы майнинга на фоне
        setInterval(() => {
            const s = document.createElement('span');
            s.innerText = "01$#"[Math.floor(Math.random()*4)];
            s.style.cssText = `position:absolute;left:${Math.random()*100}%;top:${Math.random()*100}%;color:rgba(255,255,255,0.1);font-size:10px;`;
            document.getElementById('bg-glass').appendChild(s);
            setTimeout(() => s.remove(), 1500);
        }, 300);
    </script>
</body>
</html>
